<Page x:ConnectionId='1'
    x:Class="GSCFieldApp.Views.MapPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:Behaviors="using:Template10.Behaviors"
    xmlns:Controls="using:Template10.Controls"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:GSCFieldApp.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:maps="using:Windows.UI.Xaml.Controls.Maps"
    xmlns:vm="using:GSCFieldApp.ViewModels"
    xmlns:views="using:GSCFieldApp.Views"
    xmlns:esriUI="using:Esri.ArcGISRuntime.UI.Controls"
    xmlns:esriToolkit="using:Esri.ArcGISRuntime.Toolkit.UI.Controls"
    xmlns:conv="using:GSCFieldApp.Converters"
    xmlns:model="using:GSCFieldApp.Models"
    mc:Ignorable="d">


    <Page.DataContext>
        <vm:MapPageViewModel x:ConnectionId='2' x:Name="ViewModel" />
    </Page.DataContext>

    <Page.Resources>
        <conv:ScaleConverter x:ConnectionId='3' x:Name="FormatScale" />
        <conv:DD2DMSConverter x:ConnectionId='4' x:Name="DD2DMS" />
        <conv:HorizontalAccuracyConverter x:ConnectionId='5' x:Name="FormatAccuracy" />
        <conv:ElevationConverter x:ConnectionId='6' x:Name="FormatElevation" />
        <conv:VisibilityFromBoolConverter x:ConnectionId='7' x:Name="VisibilityFromBoolConverter"/>

        <!--Layer data template-->
        <DataTemplate x:Key="MapsDialogTemplate"                         >

            <RelativePanel x:ConnectionId='8'>

                <ToggleSwitch x:ConnectionId='9' Margin="5" 
                                                   x:Name="mapFileName" 
                                                                                 />
                <Slider x:ConnectionId='10' x:Name="opacitySlider"                         
                        Width="100" Maximum="100"                             
                        StepFrequency="5"
                        RelativePanel.RightOf="mapFileName"
                        RelativePanel.AlignBottomWith="mapFileName"
                                                                 
                        Margin="-75,0,0,0"/>                
                <SymbolIcon x:ConnectionId='11' x:Name="MapDeleteIcon" Margin="10,0,0,10" 
                            RelativePanel.RightOf="opacitySlider"                                    
                            RelativePanel.AlignBottomWith="mapFileName"
                            Symbol="Delete"                              />
            </RelativePanel>

        </DataTemplate>

    </Page.Resources>

    <RelativePanel>

        <Controls:PageHeader x:ConnectionId='12' x:Name="pageHeader" RelativePanel.AlignLeftWithPanel="True" CommandBarOverflowPresenterStyle="{StaticResource CommandBarOverflowPresenterStyleMapPage}"
                             RelativePanel.AlignRightWithPanel="True"
                             RelativePanel.AlignTopWithPanel="True" x:Uid="MapPageHeader">
            <!--  primary commands  -->
            <Controls:PageHeader.PrimaryCommands>
                <AppBarButton x:ConnectionId='36' x:Name="MapPageStationCommandButton" Label="" MaxWidth="55" Foreground="White" Icon="Map"                                                        x:Uid="MapPageStationCommand" />
                <AppBarButton x:ConnectionId='37' x:Name="MapPageSampleCommandButton" Label="" MaxWidth="55" Foreground="White" Icon="Tag"                                                        x:Uid="MapPageSampleCommand"                                                                     />
                <AppBarButton x:ConnectionId='38' x:Name="MapPagePhotoCommandButton" Label="" MaxWidth="55" Foreground="White" Icon="Pictures"                                                        x:Uid="MapPagePhotoCommand"                                                                    />
                <AppBarButton x:ConnectionId='39' x:Name="MapPageStrucCommandButton" Label="" MaxWidth="55" Foreground="White" Icon="Directions"                                                        x:Uid="MapPageMeasureCommand"                                                                          />
                <AppBarButton x:ConnectionId='40' x:Name="AddWaypoint" Label="" x:Uid="MapPageAddWaypoint" Foreground="White" Icon="Flag"                                                       />
            </Controls:PageHeader.PrimaryCommands>
            <Controls:PageHeader.SecondaryCommands>
                <AppBarButton x:ConnectionId='41' x:Name="MapPageLocationCommandButton" Label="Manual XY entry" Foreground="White"                                                        x:Uid="MapPageLocationCommand" />
            </Controls:PageHeader.SecondaryCommands>

        </Controls:PageHeader>

        <Controls:PageHeader x:ConnectionId='13' x:Name="pageFooter" VerticalAlignment="Bottom" RelativePanel.AlignLeftWithPanel="True"
                             RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignBottomWithPanel="True">
            <AppBarButton x:ConnectionId='29' Foreground="White" Icon="OpenFile" Width="55" x:Uid="MapPageAddMaps" x:Name="MapPageAddMap"                              />
            <AppBarButton x:ConnectionId='30' x:Name="AddMaps" Label="" x:Uid="MapPageMapMenu"  Foreground="White" Width="55">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE81E;"/>
                </AppBarButton.Icon>
                <AppBarButton.Flyout>

                    <Flyout x:ConnectionId='34'                                                x:Name="mapPageLayerFlyout">
                        <RelativePanel Width="Auto">
                            <ListView x:ConnectionId='35' x:Name="MapLayerListView"
                                CanReorderItems="True" RelativePanel.AlignRightWithPanel="True"
                                Width="Auto"
                                AllowDrop="True"
                                                                                            
                                ItemTemplate="{StaticResource MapsDialogTemplate}"
                                                                                            >
                            </ListView>
                        </RelativePanel>

                    </Flyout>

                </AppBarButton.Flyout>
            </AppBarButton>
            <AppBarButton x:ConnectionId='31' x:Name="MapInfo" Label="" x:Uid="MapPageDisplayInfo"  Width="55" Foreground="White" Icon="ViewAll"                             />
            <AppBarButton x:ConnectionId='32' x:Name="GPSMode" Label="" x:Uid="MapPageGPSModes"  Foreground="White" Width="55"                              >
                <AppBarButton.Icon>
                    <SymbolIcon x:ConnectionId='33'                                                        x:Name="GPSModeIcon"/>
                </AppBarButton.Icon>
                <!--<AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#59421;" x:Name="GPSModeIcon"/>
                </AppBarButton.Icon>-->
                <!--<AppBarButton.Flyout>
                    <Flyout>
                        <ListView x:Name="gpsmodeflyout" ItemsSource="{x:Bind GPSModeList}" SelectionChanged="GPSModeSelectionChanged" />
                    </Flyout>
                </AppBarButton.Flyout>-->
            </AppBarButton>

        </Controls:PageHeader>

        <TextBlock x:ConnectionId='14' x:Uid="WatermarkNoMaps" 
                                                                                                                                       
                   Style="{StaticResource WatermarkText}"/>
        
        <Grid x:ConnectionId='15' x:Name="MapBorder" RelativePanel.Below="pageHeader" RelativePanel.Above="pageFooter" RelativePanel.AlignLeftWithPanel="True"
                             RelativePanel.AlignRightWithPanel="True">
            <!--<esriUI:MapView x:Name="myMapView" Tapped="{x:Bind ViewModel.myMapView_Tapped}" WrapAroundMode="EnabledWhenSupported"/>-->
            <esriUI:MapView x:ConnectionId='18' x:Name="myMapView"                                                       IsDoubleTapEnabled="True"/>

            <RelativePanel>
                <Border x:ConnectionId='21' x:Name="MapCoordinateInfo" CornerRadius="5,5,5,5" Style="{ThemeResource FieldMapBorderStyle}" HorizontalAlignment="Left" VerticalAlignment="Top"  Margin="5,5,0,0" >

                    <TextBlock x:ConnectionId='25' Name="MapCoordinateText" TextWrapping="Wrap" FontWeight="Bold" Margin="5,0,5,0" >

                    <Run Text="Location: "/>
                    <Run x:ConnectionId='26'                                                                                                                         />
                    <Run x:ConnectionId='27'                                                                                                                           />
                    <Run x:ConnectionId='28'                                                                                                   />
                    </TextBlock>

                </Border>

                <Border x:ConnectionId='22' x:Name="MapCoordinateInfo2" RelativePanel.Below="MapCoordinateInfo" CornerRadius="5,5,5,5" Style="{ThemeResource FieldMapBorderStyle}" HorizontalAlignment="Left" VerticalAlignment="Top"  Margin="5,5,0,0" >

                    <TextBlock x:ConnectionId='23' Name="MapCoordinateAccuracyText" TextWrapping="Wrap" FontWeight="Bold" Margin="5,0,5,0" >

                    <Run Text="Accuracy (XY): "/>
                    <Run x:ConnectionId='24'                                                                                                  />
                    </TextBlock>

                </Border>
            </RelativePanel>


            <Border x:ConnectionId='19' Name="MapScaleInfo" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="5,0,0,20" >
                <esriToolkit:ScaleLine x:ConnectionId='20'                             />
            </Border>

            <!--<TextBlock TextWrapping="Wrap" FontWeight="Bold" Margin="5,0,5,0">
                    <Run>Map Scale: 1:</Run>
                    <Run Text="{Binding ElementName=myMapView, Converter={StaticResource FormatScale}, ConverterParameter='{}{0:0,0}', Path=MapScale}"/>
            </TextBlock>-->


            <!--<RelativePanel HorizontalAlignment="Center" Height="150" Width="250" VerticalAlignment="Bottom" Visibility="{x:Bind ViewModel.GPSSignalReceptionVisibility, Mode=TwoWay, Converter={StaticResource VisibilityFromBoolConverter}}">
                <Rectangle x:Name="NoGPSSignalRectangle"  RelativePanel.AlignBottomWithPanel="True" RelativePanel.AlignTopWithPanel="True" RelativePanel.AlignLeftWithPanel="True" RelativePanel.AlignRightWithPanel="True" Fill="Red" Margin="0,0,0,5" Opacity="0.7"/>
                <TextBlock x:Uid="NoGPSSignalContent" x:Name="NoGPSSignalContentText" FontWeight="Bold" RelativePanel.AlignHorizontalCenterWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True"/>
                
            </RelativePanel>-->


        </Grid>


        <ProgressRing x:ConnectionId='16' x:Name="MapProgressRing"                                                          
                      Width="130" Height="50" RelativePanel.AlignHorizontalCenterWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True"
                                                                                                                                             Padding="0" VerticalAlignment="Center"/>
        <TextBlock x:ConnectionId='17' x:Name="MapProgressRingAcquiringGPSLabel" x:Uid="MapProgressRingAcquiringGPSLabel"                                                                                                                                         Text="Acquiring GPS please wait" RelativePanel.AlignVerticalCenterWith="MapProgressRing" Margin="5,0,0,0" RelativePanel.RightOf="MapProgressRing"/>

    </RelativePanel>
</Page>

